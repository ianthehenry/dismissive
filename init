#!/usr/bin/env sh

set -e

for lib in core mailer servant; do
  cd "$lib"
  cabal sandbox init
  cabal install --only-dependencies -j
  cd -
done

mkdir ./.cabal-sandbox

for service in receiver sender web; do
  cd "$service"
  cabal sandbox init --sandbox ../.cabal-sandbox
  cabal sandbox add-source ../core
  cabal sandbox add-source ../servant
  cabal sandbox add-source ../mailer
  ln -sf ../conf shared.conf
  cabal install --only-dependencies -j
  cd -
done

for lib in servant; do
  cd "$lib"
  cabal sandbox add-source ../mailer
  cd -
done
